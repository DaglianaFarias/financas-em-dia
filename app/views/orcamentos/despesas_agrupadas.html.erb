<%= render 'despesas/card_categoria_parcelas' %>

<% @despesas_orcamentos.each_slice(2) do |par_orcamentos| %>
  <div class="row">
    <% par_orcamentos.each do |orcamento| %>
      <div class="col-md-6 mb-4">
        <div class="card shadow-sm border-0 rounded-4 h-100">
          <div class="card-header bg-white border-bottom-0 rounded-top-4 px-4 py-3">
            <div class="row align-items-center mb-3">
              <div class="col">
                <h6 class="mb-0 text-dark fw-semibold"><%= orcamento.categoria %></h6>
                <small class="text-muted"><%= orcamento.descricao %></small>
              </div>
              <div class="col-auto">
                <%= link_to "Adicionar", new_despesa_path(categoria: 'gastos', orcamento: orcamento), class: 'btn btn-sm btn-outline-primary' %>
              </div>
            </div>
          
            <% valorGasto = orcamento.despesas.sum(:valor) %>
            <%= barra_de_progresso(orcamento.valorEstimado, valorGasto) %>
          </div>
          

          <div class="card-body p-0">
            <% if orcamento.despesas.present? %>
              <table class="table table-hover mb-0 align-middle">
                <thead class="bg-light text-muted small">
                  <tr>
                    <th class="ps-4">Descrição</th>
                    <th>Valor</th>
                    <th class="pe-4 text-end">Data</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <% orcamento.despesas.each do |despesa| %>
                    <tr class="small">
                      <td class="ps-4"><%= despesa.descricao %></td>
                      <td>
                        R$ <%= number_to_currency(despesa.valor, unit: "", separator: ",", delimiter: ".", precision: 2) %>
                      </td>
                      <td class="pe-4 text-end"><%= formatar_data(despesa.data_gasto) %></td>
                      <td>
                        <div class="d-flex gap-2 justify-content-center">
                          <%= link_to edit_despesa_path(despesa), title: 'Editar', data: { bs_toggle: 'tooltip' }, class: 'text-success' do %>
                            <i class="fa-solid fa-pen-to-square icon-action"></i>
                          <% end %>
                        
                          <%= link_to despesa_path(despesa), method: :delete, data: { confirm: 'Tem certeza?', bs_toggle: 'tooltip' }, title: 'Excluir', class: 'text-danger' do %>
                            <i class="fa-solid fa-trash-can icon-action"></i>
                          <% end %>
                        </div>                        
                      </td>                      
                    </tr>
                  <% end %>
                </tbody>
              </table>
            <% else %>
              <div class="px-4 py-3 text-center text-muted small">
                Nenhuma despesa cadastrada para o período.
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
